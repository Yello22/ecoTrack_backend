// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String  @id @default(cuid())
  email     String  @unique
  phone     String?
  firstName String?
  lastName  String?
  password  String
  roles     Roles[]   @default([customer])

  tutorials   Tutorials?   @relation(fields: [tutorialsId], references: [id])
  simulations Simulation[]
  tutorialsId String?      @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime

  TokenWhiteList TokenWhiteList[]
}

model TokenWhiteList {
  id             String   @id @default(cuid())
  userId         String   @unique // Unique constraint ensures one-to-one with a user
  accessToken    String?
  refreshToken   String?
  refreshTokenId String?
  expiredAt      DateTime
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  user           User     @relation(fields: [userId], references: [id])
}

enum Roles {
  admin
  customer
}

model Tutorials {
  id               String  @id @default(uuid())
  testIntro        Boolean
  scoreExplanation Boolean

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?

  user User?
}

model Simulation {
  id                String           @id @default(uuid())
  situation         Json
  foldedSteps       String[]
  actionChoices     Json
  computedResults   Json
  progression       Float
  user              User             @relation(fields: [userId], references: [id])
  userId            String

  date      DateTime
  updatedAt DateTime @updatedAt
  deletedAt DateTime?
}
